[Interface]
Address = 10.100.100.1/24
PostUp = iptables -A FORWARD -i %i -j ACCEPT
PostUp = iptables -A FORWARD -o %i -j ACCEPT
PostUp = iptables -t nat -A POSTROUTING -s 10.100.100.0/24 -o vmbr0 -j MASQUERADE
PostUp = /etc/wireguard/wg0-client-rules
PostDown = iptables -D FORWARD -i %i -j ACCEPT
PostDown = iptables -D FORWARD -o %i -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -s 10.100.100.0/24 -o vmbr0 -j MASQUERADE
ListenPort = 51820
PrivateKey =

# # Forward rules for VPN access to LXC subnets
# PostUp = iptables -C FORWARD -i %i -j ACCEPT 2>/dev/null || iptables -A FORWARD -i %i -j ACCEPT
# PostUp = iptables -C FORWARD -o %i -j ACCEPT 2>/dev/null || iptables -A FORWARD -o %i -j ACCEPT

# # Allow VPN clients to access LXC networks (no NAT needed)
# PostUp = iptables -C FORWARD -s $VPN_NET -d 10.10.10.0/24 -j ACCEPT 2>/dev/null || iptables -A FORWARD -s $VPN_NET -d 10.10.10.0/24 -j ACCEPT
# PostUp = iptables -C FORWARD -s $VPN_NET -d 10.20.20.0/24 -j ACCEPT 2>/dev/null || iptables -A FORWARD -s $VPN_NET -d 10.20.20.0/24 -j ACCEPT
# # Allow return traffic from LXC networks to VPN
# PostUp = iptables -C FORWARD -s 10.10.10.0/24 -d $VPN_NET -j ACCEPT 2>/dev/null || iptables -A FORWARD -s 10.10.10.0/24 -d $VPN_NET -j ACCEPT
# PostUp = iptables -C FORWARD -s 10.20.20.0/24 -d $VPN_NET -j ACCEPT 2>/dev/null || iptables -A FORWARD -s 10.20.20.0/24 -d $VPN_NET -j ACCEPT
# # Optional: NAT for VPN internet access (comment out if not needed)
# PostUp = iptables -t nat -C POSTROUTING -s $VPN_NET -o $EXT_IF -j MASQUERADE 2>/dev/null || iptables -t nat -A POSTROUTING -s $VPN_NET -o $EXT_IF -j MASQUERADE
# # Cleanup rules
# PostDown = iptables -D FORWARD -i %i -j ACCEPT 2>/dev/null || true
# PostDown = iptables -D FORWARD -o %i -j ACCEPT 2>/dev/null || true
# PostDown = iptables -D FORWARD -s $VPN_NET -d 10.10.10.0/24 -j ACCEPT 2>/dev/null || true
# PostDown = iptables -D FORWARD -s $VPN_NET -d 10.20.20.0/24 -j ACCEPT 2>/dev/null || true
# PostDown = iptables -D FORWARD -s 10.10.10.0/24 -d $VPN_NET -j ACCEPT 2>/dev/null || true
# PostDown = iptables -D FORWARD -s 10.20.20.0/24 -d $VPN_NET -j ACCEPT 2>/dev/null || true
# PostDown = iptables -t nat -D POSTROUTING -s $VPN_NET -o $EXT_IF -j MASQUERADE 2>/dev/null || true